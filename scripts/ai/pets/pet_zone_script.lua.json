{"type":"Chunk","body":[],"comments":[{"type":"Comment","value":"require('o_mis')\r\n\r\n\r\n-- stores all flowers\r\nFLOWERS = {}\r\n\r\n\r\n\r\nfunction onTimerDone(self, msg)\r\n\r\n    \tif ( msg.name == \"start\" ) then\r\n\r\n         \t--print(\"spawning Pet-Nodes\") \r\n\t      ReSpawnChild(self)\r\n\r\n\tend\r\n\r\n\tif ( msg.name == \"die\" ) then\r\n\r\n      \tDeadChild(self)\r\n           \t--print(\"Re----spawning Pet-Node\") \r\n\r\n    \tend   \r\n\r\nend\r\n\r\n\r\nfunction onStartup(self)\r\n \r\n    self:SetVar(\"NumberOfChildren\", 0 ) -- Dont not change this Val <<< \r\n    self:SetVar(\"WP_Num\", 1)           -- Dont not change this Val <<<    \r\n    --/////////////////////////////////////////////\r\n    -- Settings  (Alpha =a) \" a_1 (Num = 1) a_1 = the WayPoint Set\r\n    --/////////////////////////////////////////////\r\n    self:SetVar(\"PetNames\", \"nodes\") \r\n    self:SetVar(\"WP_Alpha\", \"t\")   -- starting letter of the Way Point ( a_1 = a)  or (anyName_1) \r\n    self:SetVar(\"MaxPets\", 9)      -- Max Pets Spawn in the wrold\r\n    self:SetVar(\"TotalPets\", 9)    -- Total Number of Pets\r\n    self:SetVar(\"TreasureID\", 3495) \r\n    --/////////////////////////////////////////////\r\n    --/////////////////////////////////////////////\r\n    -- define total pet IDs\r\n    for i = 1, self:GetVar(\"TotalPets\") do\r\n         self:SetVar(\"Pet_\"..i, self:GetVar(\"TreasureID\"))\r\n         -- attach WP to NPC\r\n         self:SetVar(\"slot_\"..i, nil ) \r\n    end  \r\n   \r\n   \r\n    for i = 1,  self:GetVar(\"TotalPets\")  do  \r\n        local FinalName = (self:GetVar(\"PetNames\")..\"_\"..self:GetVar(\"WP_Alpha\")..i)\r\n        self:SetVar(FinalName, \"NotSpawned\") \r\n    end\r\n     GAMEOBJ:GetTimer():AddTimerWithCancel(15, \"start\",self )\r\nend\r\n\r\n\r\n\r\n \r\nfunction DeadChild(self)\r\n\r\n\t-- Remove a child node from the number of nodes\r\n      local NChildren =  self:GetVar(\"NumberOfChildren\") - 1 \r\n      self:SetVar(\"NumberOfChildren\", NChildren ) \r\n\r\n\t-- Spawn a new child in\r\n      ReSpawnChild(self)\r\n\r\nend \r\n\r\nfunction ReSpawnChild(self) \r\n\r\n        if  self:GetVar(\"NumberOfChildren\") < self:GetVar(\"MaxPets\") then\r\n\r\n             local ran = GetValidRandom(self) \r\n\r\n             for i = 1,  self:GetVar(\"TotalPets\")  do  \r\n\r\n                \tlocal FinalName = (self:GetVar(\"PetNames\")..\"_\"..self:GetVar(\"WP_Alpha\")..i)\r\n\r\n                \tif ran == i and self:GetVar(FinalName) == \"NotSpawned\" then\r\n                    \tSpawnPet(self, i ) \r\n               \tend\r\n\r\n             end \r\n       end\r\nend\r\n\r\nonChildLoaded = function(self,msg)\r\n     \r\n\tif  msg.childID:GetLOT().objtemplate ==  self:GetVar(\"TreasureID\") then\r\n      \tlocal FinalName = (self:GetVar(\"PetNames\")..\"_\"..self:GetVar(\"WP_Alpha\")..self:GetVar(\"ChildLoadNUM\"))\r\n            msg.childID:SetVar(\"SpawnedVar\", FinalName )\r\n            local FreeSlot = GetValidRandom(self) \r\n           \r\n            msg.childID:SetVar(\"attached_path\",  self:GetVar(\"WP_Alpha\")..\"_\"..self:GetVar(\"ChildLoadNUM\"))\r\n            msg.childID:SetVar(\"I_Have_A_Parent\", true )\r\n            storeParent(self,  msg.childID)\r\n\tend\r\n\r\nend \r\n\r\n\r\n--************************************************************************************\r\n--**   Functions \r\n--************************************************************************************\r\nfunction SpawnPet(self, num ) \r\n     \r\n\tfor i = 1,  self:GetVar(\"TotalPets\")  do  \r\n        \r\n\t\tif ( num == i ) then\r\n\t\t\tlocal firstWP = GAMEOBJ:GetWaypointPos( self:GetVar(\"WP_Alpha\")..\"_\"..i, 1)\r\n            \tself:SetVar(\"ChildLoadNUM\", i ) \r\n             \t--local config = { {\"markedAsPhantom\", true} }\r\n             \tRESMGR:LoadObject { objectTemplate =  self:GetVar(\"TreasureID\"),  x=  firstWP.x  , y=  firstWP.y , z=  firstWP.z  , owner = self,  configData = config } -- A1  \r\n             \tself:SetVar(self:GetVar(\"PetNames\")..\"_\"..self:GetVar(\"WP_Alpha\")..i, \"Spawned\" )  \r\n             \tlocal NChildren =  self:GetVar(\"NumberOfChildren\") + 1 \r\n             \tself:SetVar(\"NumberOfChildren\", NChildren ) \r\n             \tbreak\r\n        \tend \r\n        \r\n     \tend\r\n\r\n\tif  self:GetVar(\"NumberOfChildren\") < self:GetVar(\"MaxPets\") + 1 then\r\n    \r\n\t  \tReSpawnChild(self) \r\n\r\n\tend \r\n\r\nend\r\n\r\nfunction GetValidRandom(self) \r\n\r\n    while true do \r\n      \tNUM = math.random(1,self:GetVar(\"TotalPets\"))  \r\n\t      FinalName = (self:GetVar(\"PetNames\")..\"_\"..self:GetVar(\"WP_Alpha\")..NUM)\r\n        \t\r\n\t\tif self:GetVar(FinalName) == \"NotSpawned\" then \r\n            \tbreak\r\n       \tend\r\n    end \r\n\r\n    return NUM \r\nend \r\n\r\n\r\nfunction onNotifyObject(self, msg)\r\n\r\n\tif (msg.name == \"died\") then\r\n      \r\n\t\tGAMEOBJ:GetTimer():AddTimerWithCancel( 20, \"die\",self )\r\n\r\n\tend\r\nend\r\n\r\n\r\n\r\n--------------------------------------------------------------\r\n-- When objects are loaded via zone notification\r\n--------------------------------------------------------------\r\nfunction onObjectLoaded(self, msg)\r\n\tif ( msg.templateID == 3646 ) then\r\n\t\tlocal nextFlower = #FLOWERS + 1\r\n        FLOWERS[nextFlower] = msg.objectID:GetID()\r\n\tend\r\nend\r\n\r\n\r\n\r\n--------------------------------------------------------------\r\n-- called when a player is loaded and ready\r\n--------------------------------------------------------------\r\nfunction onPlayerLoaded(self, msg)\r\n\t\r\n\t-- send the player's ID to the flowers so each of them can tell the newly-loaded client which anim to use\r\n\tfor flowerID = 1, #FLOWERS do\r\n        local flower = GAMEOBJ:GetObjectByID(FLOWERS[flowerID])\r\n        flower:NotifyObject{ ObjIDSender = msg.playerID, name = \"playerLoaded\" }\r\n\tend\r\n\r\nend\r\n","raw":"--[[\r\nrequire('o_mis')\r\n\r\n\r\n-- stores all flowers\r\nFLOWERS = {}\r\n\r\n\r\n\r\nfunction onTimerDone(self, msg)\r\n\r\n    \tif ( msg.name == \"start\" ) then\r\n\r\n         \t--print(\"spawning Pet-Nodes\") \r\n\t      ReSpawnChild(self)\r\n\r\n\tend\r\n\r\n\tif ( msg.name == \"die\" ) then\r\n\r\n      \tDeadChild(self)\r\n           \t--print(\"Re----spawning Pet-Node\") \r\n\r\n    \tend   \r\n\r\nend\r\n\r\n\r\nfunction onStartup(self)\r\n \r\n    self:SetVar(\"NumberOfChildren\", 0 ) -- Dont not change this Val <<< \r\n    self:SetVar(\"WP_Num\", 1)           -- Dont not change this Val <<<    \r\n    --/////////////////////////////////////////////\r\n    -- Settings  (Alpha =a) \" a_1 (Num = 1) a_1 = the WayPoint Set\r\n    --/////////////////////////////////////////////\r\n    self:SetVar(\"PetNames\", \"nodes\") \r\n    self:SetVar(\"WP_Alpha\", \"t\")   -- starting letter of the Way Point ( a_1 = a)  or (anyName_1) \r\n    self:SetVar(\"MaxPets\", 9)      -- Max Pets Spawn in the wrold\r\n    self:SetVar(\"TotalPets\", 9)    -- Total Number of Pets\r\n    self:SetVar(\"TreasureID\", 3495) \r\n    --/////////////////////////////////////////////\r\n    --/////////////////////////////////////////////\r\n    -- define total pet IDs\r\n    for i = 1, self:GetVar(\"TotalPets\") do\r\n         self:SetVar(\"Pet_\"..i, self:GetVar(\"TreasureID\"))\r\n         -- attach WP to NPC\r\n         self:SetVar(\"slot_\"..i, nil ) \r\n    end  \r\n   \r\n   \r\n    for i = 1,  self:GetVar(\"TotalPets\")  do  \r\n        local FinalName = (self:GetVar(\"PetNames\")..\"_\"..self:GetVar(\"WP_Alpha\")..i)\r\n        self:SetVar(FinalName, \"NotSpawned\") \r\n    end\r\n     GAMEOBJ:GetTimer():AddTimerWithCancel(15, \"start\",self )\r\nend\r\n\r\n\r\n\r\n \r\nfunction DeadChild(self)\r\n\r\n\t-- Remove a child node from the number of nodes\r\n      local NChildren =  self:GetVar(\"NumberOfChildren\") - 1 \r\n      self:SetVar(\"NumberOfChildren\", NChildren ) \r\n\r\n\t-- Spawn a new child in\r\n      ReSpawnChild(self)\r\n\r\nend \r\n\r\nfunction ReSpawnChild(self) \r\n\r\n        if  self:GetVar(\"NumberOfChildren\") < self:GetVar(\"MaxPets\") then\r\n\r\n             local ran = GetValidRandom(self) \r\n\r\n             for i = 1,  self:GetVar(\"TotalPets\")  do  \r\n\r\n                \tlocal FinalName = (self:GetVar(\"PetNames\")..\"_\"..self:GetVar(\"WP_Alpha\")..i)\r\n\r\n                \tif ran == i and self:GetVar(FinalName) == \"NotSpawned\" then\r\n                    \tSpawnPet(self, i ) \r\n               \tend\r\n\r\n             end \r\n       end\r\nend\r\n\r\nonChildLoaded = function(self,msg)\r\n     \r\n\tif  msg.childID:GetLOT().objtemplate ==  self:GetVar(\"TreasureID\") then\r\n      \tlocal FinalName = (self:GetVar(\"PetNames\")..\"_\"..self:GetVar(\"WP_Alpha\")..self:GetVar(\"ChildLoadNUM\"))\r\n            msg.childID:SetVar(\"SpawnedVar\", FinalName )\r\n            local FreeSlot = GetValidRandom(self) \r\n           \r\n            msg.childID:SetVar(\"attached_path\",  self:GetVar(\"WP_Alpha\")..\"_\"..self:GetVar(\"ChildLoadNUM\"))\r\n            msg.childID:SetVar(\"I_Have_A_Parent\", true )\r\n            storeParent(self,  msg.childID)\r\n\tend\r\n\r\nend \r\n\r\n\r\n--************************************************************************************\r\n--**   Functions \r\n--************************************************************************************\r\nfunction SpawnPet(self, num ) \r\n     \r\n\tfor i = 1,  self:GetVar(\"TotalPets\")  do  \r\n        \r\n\t\tif ( num == i ) then\r\n\t\t\tlocal firstWP = GAMEOBJ:GetWaypointPos( self:GetVar(\"WP_Alpha\")..\"_\"..i, 1)\r\n            \tself:SetVar(\"ChildLoadNUM\", i ) \r\n             \t--local config = { {\"markedAsPhantom\", true} }\r\n             \tRESMGR:LoadObject { objectTemplate =  self:GetVar(\"TreasureID\"),  x=  firstWP.x  , y=  firstWP.y , z=  firstWP.z  , owner = self,  configData = config } -- A1  \r\n             \tself:SetVar(self:GetVar(\"PetNames\")..\"_\"..self:GetVar(\"WP_Alpha\")..i, \"Spawned\" )  \r\n             \tlocal NChildren =  self:GetVar(\"NumberOfChildren\") + 1 \r\n             \tself:SetVar(\"NumberOfChildren\", NChildren ) \r\n             \tbreak\r\n        \tend \r\n        \r\n     \tend\r\n\r\n\tif  self:GetVar(\"NumberOfChildren\") < self:GetVar(\"MaxPets\") + 1 then\r\n    \r\n\t  \tReSpawnChild(self) \r\n\r\n\tend \r\n\r\nend\r\n\r\nfunction GetValidRandom(self) \r\n\r\n    while true do \r\n      \tNUM = math.random(1,self:GetVar(\"TotalPets\"))  \r\n\t      FinalName = (self:GetVar(\"PetNames\")..\"_\"..self:GetVar(\"WP_Alpha\")..NUM)\r\n        \t\r\n\t\tif self:GetVar(FinalName) == \"NotSpawned\" then \r\n            \tbreak\r\n       \tend\r\n    end \r\n\r\n    return NUM \r\nend \r\n\r\n\r\nfunction onNotifyObject(self, msg)\r\n\r\n\tif (msg.name == \"died\") then\r\n      \r\n\t\tGAMEOBJ:GetTimer():AddTimerWithCancel( 20, \"die\",self )\r\n\r\n\tend\r\nend\r\n\r\n\r\n\r\n--------------------------------------------------------------\r\n-- When objects are loaded via zone notification\r\n--------------------------------------------------------------\r\nfunction onObjectLoaded(self, msg)\r\n\tif ( msg.templateID == 3646 ) then\r\n\t\tlocal nextFlower = #FLOWERS + 1\r\n        FLOWERS[nextFlower] = msg.objectID:GetID()\r\n\tend\r\nend\r\n\r\n\r\n\r\n--------------------------------------------------------------\r\n-- called when a player is loaded and ready\r\n--------------------------------------------------------------\r\nfunction onPlayerLoaded(self, msg)\r\n\t\r\n\t-- send the player's ID to the flowers so each of them can tell the newly-loaded client which anim to use\r\n\tfor flowerID = 1, #FLOWERS do\r\n        local flower = GAMEOBJ:GetObjectByID(FLOWERS[flowerID])\r\n        flower:NotifyObject{ ObjIDSender = msg.playerID, name = \"playerLoaded\" }\r\n\tend\r\n\r\nend\r\n]]"},{"type":"Comment","value":"","raw":"--"}]}